var csrfToken,csrfTokenElement,dataCollectionForm,collectionInstructions,dataCollectionDiv;async function API(endpoint,data){let response=await fetch(endpoint,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":csrfToken},body:JSON.stringify(data)}),json=await response.json();return json["csrf-token"]&&(csrfToken=json["csrf-token"],csrfTokenElement.value=json["csrf-token"]),json}function initAuth(){let session;API("/api/begin-registration",{"csrf-token":csrfToken}).then((json=>{session=json["session-id"];let readData=collect(json.collect);dataCollectionForm.addEventListener("submit",(event=>{event.preventDefault();let data=readData();console.log(data),API("/api/registration/send",{"csrf-token":csrfToken,"session-id":session,data:data}).then((json=>{document.getElementById("messages").innerText=json.messages.join("\n"),readData=collect(json.collect)}))}))}))}function collect(what){if(console.log(what),"primary-email"===what){collectionInstructions.innerText="Enter your email address:",dataCollectionDiv.innerHTML="";let emailElement=$("input").attributes({type:"email",name:"email",placeholder:"Email",required:!0}).appendTo(dataCollectionDiv);return enableEmailValidation(emailElement),()=>[emailElement.value]}if("first-name"===what){collectionInstructions.innerText="Enter your first name:",dataCollectionDiv.innerHTML="";let firstNameElement=$("input").attributes({type:"text",name:"first-name",placeholder:"First Name",required:!0}).appendTo(dataCollectionDiv);return()=>[firstNameElement.value]}if("last-name"===what){collectionInstructions.innerText="Enter your last name:",dataCollectionDiv.innerHTML="";let lastNameElement=$("input").attributes({type:"text",name:"last-name",placeholder:"Last Name",required:!0}).appendTo(dataCollectionDiv);return()=>[lastNameElement.value]}if("full-name"===what){collectionInstructions.innerText="Enter your name:",dataCollectionDiv.innerHTML="";let firstNameElement=$("input").attributes({type:"text",name:"first-name",placeholder:"First Name",required:!0}).appendTo(dataCollectionDiv),lastNameElement=$("input").attributes({type:"text",name:"last-name",placeholder:"Last Name",required:!0}).appendTo(dataCollectionDiv);return()=>[firstNameElement.value,lastNameElement.value]}if("primary-phone"===what){collectionInstructions.innerText="Enter your phone number:",dataCollectionDiv.innerHTML="";let phoneElement=$("input").attributes({type:"tel",name:"phone",placeholder:"Phone",required:!0}).appendTo(dataCollectionDiv);return enablePhoneValidation(phoneElement),()=>[phoneElement.value]}if("birthday"===what){collectionInstructions.innerText="Enter your birthday:",dataCollectionDiv.innerHTML="";let yearElement=$("input").attributes({type:"number",name:"year",placeholder:"Year",required:!0}).appendTo(dataCollectionDiv),monthElement=$("input").attributes({type:"number",name:"month",placeholder:"Month",required:!0}).appendTo(dataCollectionDiv),dayElement=$("input").attributes({type:"number",name:"day",placeholder:"Day",required:!0}).appendTo(dataCollectionDiv);return()=>[yearElement.value,monthElement.value,dayElement.value]}if("country"===what){collectionInstructions.innerText="Select your country.",dataCollectionDiv.innerHTML="";let countrySelector=document.getElementById("country-selector");return countrySelector.style.display="block",()=>(countrySelector.style.display="none",[countrySelector.value])}"register-passkey"===what&&isWebAuthnAvailable().then((()=>{$("button").text("Register Passkey").appendTo(dataCollectionDiv).addEventListener("click",(event=>{event.preventDefault(),registerPasskey()}))}))}async function isWebAuthnAvailable(){if(window.PublicKeyCredential&&PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable&&PublicKeyCredential.isConditionalMediationAvailable){if((await Promise.all([PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable(),PublicKeyCredential.isConditionalMediationAvailable()])).every((r=>!0===r)))return!0}return!1}async function registerPasskey(){const publicKeyCredentialCreationOptions={challenge:Uint8Array.from([1,2,3,4,5,6,7,8,9,10]),rp:{name:"Projxon",id:"localhost:8080"},user:{id:new ArrayBuffer(16),name:"john78",displayName:"John"},pubKeyCredParams:[{alg:-7,type:"public-key"},{alg:-257,type:"public-key"}],excludeCredentials:[{id:new ArrayBuffer(16),type:"public-key",transports:["internal"]}],authenticatorSelection:{authenticatorAttachment:"platform",requireResidentKey:!0}},credential=await navigator.credentials.create({publicKey:publicKeyCredentialCreationOptions});console.log(credential)}window.addEventListener("load",(event=>{csrfTokenElement=document.getElementById("csrf-token"),csrfToken=csrfTokenElement.value,dataCollectionForm=document.getElementById("data-collection-form"),collectionInstructions=document.getElementById("collection-instructions"),dataCollectionDiv=document.getElementById("data-collection-div"),initAuth()}));const emailValidationRegex=/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/;function enableEmailValidation(element){element.addEventListener("input",(event=>{emailValidationRegex.test(element.value)?(element.removeClass("invalid"),element.class("valid")):(element.removeClass("valid"),element.class("invalid"))}))}function enablePhoneValidation(element){return element.addEventListener("input",(event=>{libphonenumber.isValidPhoneNumber(element.value,"US")?(element.removeClass("invalid"),element.class("valid")):(element.removeClass("valid"),element.class("invalid"))})),element}